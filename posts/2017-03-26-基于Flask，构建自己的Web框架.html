<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 基于Flask，构建自己的Web框架 · zhenyu</title><meta name="description" content="基于Flask，构建自己的Web框架 - zhenyu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iszhenyu.me/atom.xml" title="zhenyu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/iszhenyu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">基于Flask，构建自己的Web框架</h1><div class="post-info">Mar 26, 2017</div><div class="post-content"><p>Flask是一个使用Python编写的轻量级Web应用框架，因为它强大的自由性，从推出开始就受到大家的热捧，在官方文档和其他介绍Flask的文章中，你一定没少看到下面的代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">from flask import Flask</div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line">@app.route(&quot;/&quot;)</div><div class="line">def hello():</div><div class="line">    return &quot;Hello World!&quot;</div><div class="line"></div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">    app.run()</div></pre></td></tr></table></figure></p>
<p>简单的几行就获得了一个可运行的web应用，这让新手入门变得非常简单。但是，随着系统复杂度的上升，单个文件已经无法满足需求，于是出现了所谓的大型应用架构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">|-flasky</div><div class="line">  |-app/</div><div class="line">    |-templates/</div><div class="line">    |-static/</div><div class="line">    |-main/</div><div class="line">      |-__init__.py</div><div class="line">      |-errors.py</div><div class="line">      |-forms.py</div><div class="line">      |-views.py</div><div class="line">    |-__init__.py</div><div class="line">    |-email.py</div><div class="line">    |-models.py</div><div class="line">  |-migrations/</div><div class="line">  |-tests/</div><div class="line">    |-__init__.py</div><div class="line">    |-test*.py</div><div class="line">  |-venv/</div><div class="line">  |-requirements.txt</div></pre></td></tr></table></figure>
<p>对于不是特别复杂的系统，可以采用如上的模式开发，但实际情况是，我们通常所面对的业务要复杂的多，这样就无法把所有模型都放在同一个<code>models.py</code>文件中，同理，<code>views.py</code>、<code>forms.py</code>也是如此。除了代码结构，还有其他的一些因素需要考虑，例如：如何记录日志，如何处理错误信息等等，只要我们使用Flask，就不得不一遍遍的去做这样的事情。对于一个框架来说，开发人员应该不用去关注框架本身，而是将精力全部集中到业务实现。因此，我决定基于Flask来封装自己的web框架（<a href="https://github.com/iszhenyu/fiji" target="_blank" rel="external">Github</a>），而这个框架在很大程度上参考了<a href="http://mattupstate.com/blog/how-i-structure-my-flask-applications/" target="_blank" rel="external">How I Structure My Flask Applications</a> 这篇博客。</p>
<p>封装后的Web框架的结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── README.md</div><div class="line">├── app</div><div class="line">│   ├── __init__.py</div><div class="line">│   ├── controllers</div><div class="line">│   ├── forms</div><div class="line">│   ├── models</div><div class="line">│   ├── services</div><div class="line">│   ├── core.py</div><div class="line">│   ├── exceptions.py</div><div class="line">│   ├── extensions.py</div><div class="line">│   └── factory.py</div><div class="line">├── config</div><div class="line">│   ├── __init__.py</div><div class="line">│   ├── settings.dev.py</div><div class="line">│   ├── settings.pro.py</div><div class="line">│   └── settings.py</div><div class="line">├── logs</div><div class="line">│   └── dev.log</div><div class="line">├── manage.py</div><div class="line">├── public</div><div class="line">├── requirements</div><div class="line">│   ├── dev.txt</div><div class="line">│   └── pro.txt</div><div class="line">├── utils</div><div class="line">└── venv</div></pre></td></tr></table></figure></p>
<p>之所以这样安排目录结构，是考虑到有些同学可能是从PHP或Java转移过来的，他们还是比较熟悉按层来划分模块，而不是根据功能来划分。在使用的时候，只需要在对应的模块中添加业务代码，真正做到了开箱即用。更详细的信息大家看代码吧，地址如下：<br><a href="https://github.com/iszhenyu/fiji" target="_blank" rel="external">https://github.com/iszhenyu/fiji</a><br>也欢迎大家一起交流。</p>
<hr>
<p>微信号<code>在课间</code>，每天5分钟，分享程序员成长中的点滴，聚沙成塔，聚水成涓，一起提升自己。</p>
<p><img src="http://oliobk3g2.bkt.clouddn.com/qrcode_for_gh_c2450942f355_258.jpg" alt="在课间" title="title"></p>
</div></article></div></main><footer><div class="paginator"><a href="/posts/2017-01-25-当我们在使用Flask时，如何如记录日志.html" class="next">下一篇</a></div><div data-thread-key="posts/2017-03-26-基于Flask，构建自己的Web框架.html" data-title="基于Flask，构建自己的Web框架" data-url="http://iszhenyu.me/posts/2017-03-26-基于Flask，构建自己的Web框架.html" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"iszhenyu"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://iszhenyu.me">zhenyu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-56494721-2",'auto');ga('send','pageview');</script></body></html>
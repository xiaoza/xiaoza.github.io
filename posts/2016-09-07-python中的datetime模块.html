<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> python中的datetime模块 · zhenyu</title><meta name="description" content="python中的datetime模块 - zhenyu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iszhenyu.me/atom.xml" title="zhenyu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/iszhenyu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">python中的datetime模块</h1><div class="post-info">Sep 7, 2016</div><div class="post-content"><h2 id="timedelta"><a href="#timedelta" class="headerlink" title="timedelta"></a>timedelta</h2><h3 id="timedelta的实例化"><a href="#timedelta的实例化" class="headerlink" title="timedelta的实例化"></a>timedelta的实例化</h3><p>一个<code>timedalta</code>对象代表了一个时间差，当两个<code>date</code>或<code>datetime</code>进行相减操作时会返回一个<code>timedelta</code>对象，或者，我们也可以手动对其进行实例化，其构造函数的原型如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">datetime</span>.<span class="title">timedelta</span><span class="params">([days[, seconds[, microseconds[, milliseconds[, minutes[, hours[, weeks]]]]]]])</span></span></div></pre></td></tr></table></figure></p>
<p>其中，所有的参数都是可选的，并且默认为0，一般情况下，我们常用的是其中三个参数<code>days</code>、<code>seconds</code>、<code>microseconds</code>，如果我们传递了其他的几个参数值，python会帮助我们自动转换成上面三个参数，转换的规则是：</p>
<ul>
<li>1 millisecond（毫秒） 转换成 1000 microseconds（微秒）</li>
<li>1 minute 转换成 60 seconds</li>
<li>1 hour 转换成 3600 seconds</li>
<li>1 week转换成 7 days</li>
</ul>
<p>如果我们在实例化的时候直接传递的是上面三个参数值，那么也要注意下它们的取值范围：</p>
<ul>
<li>0 &lt;= microseconds &lt; 1000000</li>
<li>0 &lt;= seconds &lt; 3600*24 (一天的秒数)</li>
<li>-999999999 &lt;= days &lt;= 999999999</li>
</ul>
<p>那么，如果我们在传递这三个参数的时候超出了这个范围会有什么问题吗，答案是不一定，例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp = datetime.timedelta(seconds=<span class="number">86400</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp.days</div><div class="line"><span class="number">1</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp.seconds</div><div class="line"><span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>可以看到，如果超过范围，python是会帮我们自动转换的，但是如果<code>days</code>参数超出范围会有什么结果呢?<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>ee = datetime.timedelta(days=<span class="number">1000000000</span>)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">OverflowError: days=<span class="number">1000000000</span>; must have magnitude &lt;= <span class="number">999999999</span></div></pre></td></tr></table></figure></p>
<p>所以，只有<code>days</code>是不能超出范围的，否则会抛出<code>OverflowError</code>异常。</p>
<p>在实例化的时候，参数不仅仅可以是整数，也可以是浮点数、正数或者负数，当参数为负数的时候，要特别注意，因为生成的样式也许与我们设想的不太一致<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp = datetime.timedelta(microseconds=<span class="number">-1</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp.days, tmp.seconds, tmp.microseconds</div><div class="line">(<span class="number">-1</span>, <span class="number">86399</span>, <span class="number">999999</span>)</div></pre></td></tr></table></figure></p>
<p>所以，我们传递参数的时候，尽量避免传递负数的情况，同样，我们也应该极力避免传递的参数为浮点数，我们在使用的时候一般以秒作为单位就能满足99%的需求了。</p>
<h3 id="timedelta的运算"><a href="#timedelta的运算" class="headerlink" title="timedelta的运算"></a>timedelta的运算</h3><h4 id="操作"><a href="#操作" class="headerlink" title="+ 操作"></a><code>+</code> 操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = datetime.timedelta(seconds=<span class="number">60</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t2 = datetime.timedelta(seconds=<span class="number">30</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t3 = t1 + t2</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t3.seconds</div><div class="line"><span class="number">90</span></div></pre></td></tr></table></figure>
<h4 id="操作-1"><a href="#操作-1" class="headerlink" title="- 操作"></a><code>-</code> 操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>t4 = t1 -t2</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t4.seconds</div><div class="line"><span class="number">30</span></div></pre></td></tr></table></figure>
<h4 id="操作-2"><a href="#操作-2" class="headerlink" title="* 操作"></a><code>*</code> 操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>t5 = t1 * <span class="number">2</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t5</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">120</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t6 = t1 * <span class="number">0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t6</div><div class="line">datetime.timedelta(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<h4 id="或-操作"><a href="#或-操作" class="headerlink" title="/ 或 //操作"></a><code>/</code> 或 <code>//</code>操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>t7 = t1 / <span class="number">3</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t7</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">20</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t7 = t1 / <span class="number">7</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t7</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">8</span>, <span class="number">571428</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t7 = t1 // <span class="number">7</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t7</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">8</span>, <span class="number">571428</span>)</div></pre></td></tr></table></figure>
<p>注意这里的被除数不能是0，否则会抛出<code>ZeroDivisionError</code>。</p>
<h4 id="比较操作"><a href="#比较操作" class="headerlink" title="比较操作"></a>比较操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 &gt; t2</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 &lt; t2</div><div class="line"><span class="keyword">False</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 == t2</div><div class="line"><span class="keyword">False</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 == <span class="number">60</span></div><div class="line"><span class="keyword">False</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 != <span class="number">60</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1 &gt; <span class="number">60</span></div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">TypeError: can<span class="string">'t compare datetime.timedelta to int</span></div></pre></td></tr></table></figure>
<p>可以看到，两个<code>timedelta</code>对象可以直接进行比较操作，而一个<code>timedelta</code>对象与一个非<code>timedelta</code>对象进行<code>==</code>或<code>!=</code>操作时总是返回<code>False</code>，而进行<code>&gt;</code>或<code>&lt;</code>操作则会抛出<code>TypeError</code>。</p>
<h4 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>+t1</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">60</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>-t1</div><div class="line">datetime.timedelta(<span class="number">-1</span>, <span class="number">86340</span>)</div><div class="line"></div><div class="line">// 返回的格式为[D day[s], ][H]H:MM:SS[.UUUUUU]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>str(t1)</div><div class="line"><span class="string">'0:01:00'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">60</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>str(-t1)</div><div class="line"><span class="string">'-1 day, 23:59:00'</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>repr(t1)</div><div class="line"><span class="string">'datetime.timedelta(0, 60)'</span></div></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>在2.7版本后，新增了一个方法<code>timedelta.total_seconds()</code>用于计算秒数，它等价于<code>(td.microseconds + (td.seconds + td.days * 24 * 3600) * 10**6) / 10**6</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1</div><div class="line">datetime.timedelta(<span class="number">0</span>, <span class="number">60</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t1.total_seconds()</div><div class="line"><span class="number">60.0</span></div></pre></td></tr></table></figure></p>
<h2 id="date"><a href="#date" class="headerlink" title="date"></a>date</h2><p>一个<code>date</code>对象代表使用年、月、日表示的时间，我们可以只用年、月、日三个值直接构造一个<code>date</code>对象，且这三个参数缺一不可，它们的取值范围如下</p>
<ul>
<li>MINYEAR &lt;= year &lt;= MAXYEAR</li>
<li>1 &lt;= month &lt;= 12</li>
<li>1 &lt;= day &lt;= 给定年月的天数</li>
</ul>
<p>如果我们传递的参数超出这个范围，将会抛出<code>ValueError</code>异常。除了手动传入年、月、日来构造<code>date</code>对象外，系统还提供了静态方法，我们可以使用这些静态方法来方便的得到一个<code>date</code>对象</p>
<ul>
<li><p>date.today()<br>返回当前的本地时间，等价于<code>date.fromtimestamp(time.time())</code></p>
</li>
<li><p>date.fromtimestamp(timestamp)</p>
</li>
</ul>
<p>当得到<code>date</code>对象后，就可以直接访问它的年、月、日属性了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>today = date.today()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>today</div><div class="line">datetime.date(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">1</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>today.year</div><div class="line"><span class="number">2016</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>today.month</div><div class="line"><span class="number">9</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>today.day</div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure></p>
<h3 id="运算与比较操作"><a href="#运算与比较操作" class="headerlink" title="运算与比较操作"></a>运算与比较操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>delta = timedelta(days=<span class="number">7</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>future = today + delta</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>future</div><div class="line">datetime.date(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">8</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>future - delta</div><div class="line">datetime.date(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">1</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>future - today</div><div class="line">datetime.timedelta(<span class="number">7</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>future &gt; today</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure>
<blockquote>
<p><code>date</code>可以作为字典的key，并且，所有的<code>date</code>对象都会被认为是<code>True</code>的，也就是 if date 这个判断永远是成立的。</p>
</blockquote>
<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><ul>
<li><p>date.replace(year, month, day)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = date(<span class="number">2002</span>, <span class="number">12</span>, <span class="number">31</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">datetime.date(<span class="number">2002</span>, <span class="number">12</span>, <span class="number">31</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.replace(day=<span class="number">26</span>)</div><div class="line">datetime.date(<span class="number">2002</span>, <span class="number">12</span>, <span class="number">26</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>date.weekday()<br>返回一周的礼拜几，用int值表示，从0开始</p>
</li>
<li>date.isoweekday()<br>返回一周的礼拜几，用int值表示，从1开始</li>
<li>date.isoformat()<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d.isoformat()</div><div class="line"><span class="string">'2002-12-31'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h2><p><code>datetime</code>从字面意思上看是<code>date</code>和<code>time</code>的结合，而实际上也是包含了这两个对象的全部信息，我们可以手动构造<code>datetime</code>对象，也可以使用系统提供的静态方法，当我们手动构造的时候，必须要传入<code>year</code>、<code>month</code>和<code>day</code>三个参数，他们的取值范围与上面讲到的<code>date</code>对象一致。</p>
<p>我们在处理时间问题时，始终无法回避的是时区问题，在python中，使用<code>datetime.tzinfo</code>来表示时区，但这是一个抽象基类，python也并没帮我们实现任意的时区，因此，我们首先来看下在不涉及时区的时候<code>datetime</code>都有哪些用法，然后我们会创建一个本地时区，也就是东八区，来说明<code>datetime</code>如何与<code>tzinfo</code>结合使用。</p>
<h3 id="datetime对象的创建"><a href="#datetime对象的创建" class="headerlink" title="datetime对象的创建"></a>datetime对象的创建</h3><p>我们可以通过指定年月日的形式来手动创建一个<code>datetime</code>实例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>cur = datetime(year=<span class="number">2016</span>, month=<span class="number">9</span>, day=<span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cur</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>也可以直接通过静态方法来获的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.today()</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">17</span>, <span class="number">50</span>, <span class="number">21</span>, <span class="number">810692</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.now()</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">17</span>, <span class="number">50</span>, <span class="number">34</span>, <span class="number">89763</span>)</div></pre></td></tr></table></figure></p>
<p>这两个方法都会返回一个本地当前时间，也就是上面的两个写法是等效的，但是要注意的是，<code>now()</code>方法可以传入时区信息，我们稍后再一起讨论。</p>
<p>除了上面的方法，我们还可以通过时间戳来获取一个对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.fromtimestamp(time.time())</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">17</span>, <span class="number">54</span>, <span class="number">56</span>, <span class="number">65907</span>)</div></pre></td></tr></table></figure></p>
<p>我们这里同样暂不考虑时区的问题。<br>除了通过时间戳获取<code>datetime</code>实例外，我们还可以通过一个格式化的时间字符串来获得实例，这个方法同样是不带时区信息的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.strptime(<span class="string">'2016-09-02 18:00:00'</span>, <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>既然一个<code>datetime</code>对象包含了<code>date</code>和<code>time</code>的所有信息，那么能不能通过这两对象来生成一个<code>datetime</code>实例呢，答案是肯定的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = date(year=<span class="number">2016</span>, month=<span class="number">9</span>, day=<span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">datetime.date(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t = time(hour=<span class="number">18</span>, minute=<span class="number">14</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t</div><div class="line">datetime.time(<span class="number">18</span>, <span class="number">14</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.combine(d, t)</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">14</span>)</div></pre></td></tr></table></figure></p>
<p>现在<code>datetime</code>也有了，我们总要在它身上做点什么吧，能做什么呢？</p>
<h3 id="常用方法介绍"><a href="#常用方法介绍" class="headerlink" title="常用方法介绍"></a>常用方法介绍</h3><p>有了<code>datetime</code>对象之后，我们就可以获得对应的<code>date</code>和<code>time</code>对象了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>today = datetime.today()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>today.date()</div><div class="line">datetime.date(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>today.time()</div><div class="line">datetime.time(<span class="number">18</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">304536</span>)</div></pre></td></tr></table></figure></p>
<p>那如果我希望得到下个月的今天，该怎么做呢？方法有多种，但是最方便的是直接把月份进行加一操作（不考虑跨年和日期超过月份最大值的情况），这个时候<code>replace</code>函数就派上用场了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>next_month = today.replace(month=today.month+<span class="number">1</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>next_month</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">304536</span>)</div></pre></td></tr></table></figure></p>
<p><code>replace()</code>方法允许我们对<code>datetime</code>的任意字段进行替换，并返回一个新的<code>datetime</code>对象，这个新的对象在其他字段上与原有对象保持一致。</p>
<p>除此之外，还有一个比较常用的方法<code>strftime()</code>，通过它可以格式化成我们希望的样式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>next_month.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</div><div class="line"><span class="string">'2016-10-02 18:30:10'</span></div></pre></td></tr></table></figure></p>
<p>还有一种情况，是我们希望将一个<code>datetime</code>对象转成时间戳，很遗憾的是python并没直接提供这个方法，但是提供了一个<code>timetuple()</code>方法，它返回一个<code>time.struct_time</code>对象，通过它我们可以构造出时间戳了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>dd = datetime.today()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tt = time.mktime(dd.timetuple())</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> int(tt)</div><div class="line"><span class="number">1472816083</span></div></pre></td></tr></table></figure></p>
<h3 id="时区的定义"><a href="#时区的定义" class="headerlink" title="时区的定义"></a>时区的定义</h3><p>python中给我们提供了<code>datetime.tzinfo</code>这一抽象的基类，如果我们想使用时区，则必须继承这个类来实现自己的时区定义。我们先来看下都有哪些方法可能需要我们来实现</p>
<ul>
<li><code>tzinto.utcoffset(self, dt)</code> </li>
</ul>
<p>这个方法返回本地时间与UTC时间的时差，我们知道，我们国家使用的是东八区，也就是比世界协调时间（UTC）/格林尼治时间（GMT）快8小时的时区，因此我们可以如下实现这个方法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">utcoffset</span><span class="params">(self, dt)</span>:</span></div><div class="line">    <span class="keyword">return</span> timedelta(hours=<span class="number">8</span>)</div></pre></td></tr></table></figure></p>
<ul>
<li><code>tzinfo.dst(self, dt)</code></li>
</ul>
<p>这个方法主要是考虑到一些采用夏令时的国家，在固定月份来调整时间，而我们国家是没有采用夏令时，所以直接返回0<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dst</span><span class="params">(self, dt)</span>:</span></div><div class="line">    <span class="keyword">return</span> timedelta(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>而对于采纳了夏令时的国家，则需要把夏令时考虑进去<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dst</span><span class="params">(self, dt)</span>:</span></div><div class="line">    <span class="comment"># Code to set dston and dstoff to the time zone's DST</span></div><div class="line">    <span class="comment"># transition times based on the input dt.year, and expressed</span></div><div class="line">    <span class="comment"># in standard local time.  Then</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> dston &lt;= dt.replace(tzinfo=<span class="keyword">None</span>) &lt; dstoff:</div><div class="line">        <span class="keyword">return</span> timedelta(hours=<span class="number">1</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> timedelta(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>对于这些国家，我还要修改<code>utcoffset</code>函数，将夏令时的偏移量考虑进去<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">utcoffset</span><span class="params">(self, dt)</span>:</span></div><div class="line">    <span class="keyword">return</span> timedelta(hours=N) + self.dst(dt)</div></pre></td></tr></table></figure></p>
<ul>
<li><code>tzinfo.tzname(self, dt)</code></li>
</ul>
<p>这个方法用来返回时区的名称，没有太多可说的</p>
<p>一般情况下，我们只要实现上面三个方法就可以了，例如我们可以这样定义一个UTC时区和我们所在的东八区<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">ZERO = timedelta(<span class="number">0</span>)</div><div class="line">HOUR = timedelta(hours=<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UTC</span><span class="params">(tzinfo)</span>:</span></div><div class="line">    <span class="string">"""UTC"""</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">utcoffset</span><span class="params">(self, dt)</span>:</span></div><div class="line">        <span class="keyword">return</span> ZERO</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tzname</span><span class="params">(self, dt)</span>:</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"UTC"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dst</span><span class="params">(self, dt)</span>:</span></div><div class="line">        <span class="keyword">return</span> ZERO</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GMT8</span><span class="params">(tzinfo)</span>:</span></div><div class="line">    <span class="string">"""东八区""</span></div><div class="line"></div><div class="line">    def utcoffset(self, dt):</div><div class="line">        return HOUR * 8</div><div class="line"></div><div class="line">    def tzname(self, dt):</div><div class="line">        return 'GMT-8'</div><div class="line"></div><div class="line">    def dst(self, dt):</div><div class="line">        return ZERO</div></pre></td></tr></table></figure></p>
<p>除了我们自己来定义时区外，我们还可以使用<code>pytz</code>这个模块，通过<code>easy_install</code>命令直接安装即可。</p>
<h3 id="datetime与时区的结合使用"><a href="#datetime与时区的结合使用" class="headerlink" title="datetime与时区的结合使用"></a>datetime与时区的结合使用</h3><p>我们上面已经介绍了在不考虑时区因素的时候，<code>datetime</code>的一些简单用法，接下来看下加入时区后，有哪些不一样的地方，以及我们需要注意的地方。</p>
<p>我们在上面提到了类方法<code>now</code>，在不考虑时区的时候，它的作用和类方法<code>today</code>基本是一致的，我们也可以在使用<code>now</code>的时候传递一个<code>tzinfo</code>，如下的两种方式是等效的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">today = datetime.today()</div><div class="line">today = today.replace(tzinfo=GMT8())</div><div class="line">// 等效于</div><div class="line">today = datetime.now(GMT8())</div></pre></td></tr></table></figure></p>
<p>除了<code>now()</code>方法外，系统还提供了<code>utcnow()</code>方法，这个方法没有参数，返回的是UTC的时间，但是要注意的是，这个方法创建的<code>datetime</code>对象同样是不带时区信息的。</p>
<p>到目前为止，我们都还不知道时区到底有什么作用，假设说我们现在有这样的需求：在数据库中记录的时间全部采用UTC时间，而在展示的时候需要转换成本地时间。我们在查库后，一些ORM（例如：SQLAlchemy）会自动帮我们将时间值转化成<code>datetime</code>对象，但这些<code>datetime</code>都是不带时区信息的，如果我们想转化成本地时间则必须要创建本地的时区<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">today = datetime.utcnow()</div><div class="line">today = today.replace(tzinfo=UTC())</div><div class="line"><span class="keyword">print</span> today //<span class="number">2016</span><span class="number">-09</span><span class="number">-06</span> <span class="number">06</span>:<span class="number">47</span>:<span class="number">42.665574</span>+<span class="number">00</span>:<span class="number">00</span></div><div class="line"></div><div class="line">today = today.astimezone(GMT8())</div><div class="line"><span class="keyword">print</span> today //<span class="number">2016</span><span class="number">-09</span><span class="number">-06</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">42.665574</span>+<span class="number">08</span>:<span class="number">00</span></div></pre></td></tr></table></figure></p>
<p>如上所示，系统提供了<code>datetime.astimezone(tz)</code>方法，使用这个方法可以在各个时区之间来回转换时间。这里有两点需要注意：</p>
<ul>
<li>如果<code>datetime</code>对象本身没有包含时区信息，调用这个方法会抛出<code>ValueError</code>，并提示<code>astimezone() cannot be applied to a naive datetime</code></li>
<li><code>replace(tzinfo=...)</code>方法只会替换<code>tzinfo</code>的值，并不会更改时分秒等时间信息</li>
</ul>
<p>最后，还有两个通过时间戳获取<code>datetime</code>的类方法，<code>datetime.fromtimestamp(timestamp[, tz])</code>和<code>datetime.utcfromtimestamp(timestamp)</code>，<code>utcfromtimestamp</code>得到的是一个UTC时间，并且不带<code>tzinfo</code>信息，除此之外，两者并无太大区别。</p>
<p>到这里，<code>datetime</code>模块的大部分方法就介绍完了，还有一些我们不是很常用的方法，大家可以自行看看文档了解下就好。</p>
</div></article></div></main><footer><div class="paginator"><a href="/posts/2016-10-13-MongDB索引的介绍及使用.html" class="prev">上一篇</a><a href="/posts/2016-07-01-Android中与js进行交互.html" class="next">下一篇</a></div><div data-thread-key="posts/2016-09-07-python中的datetime模块.html" data-title="python中的datetime模块" data-url="http://iszhenyu.me/posts/2016-09-07-python中的datetime模块.html" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"iszhenyu"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://iszhenyu.me">zhenyu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-56494721-2",'auto');ga('send','pageview');</script></body></html>